<!DOCTYPE html>
<html lang="en">
<head>
  <!-- (Previous head content remains the same) -->
</head>
<body>
  <div class="cyber-terminal">
    <!-- (Previous terminal-header remains the same) -->
    <div class="terminal-body" id="terminalOutput">
      <!-- (Previous terminal lines remain the same) -->
      <div class="injection-lab">
        <h3>TEST LOGIN FORM</h3>
        <div class="login-form">
          <input type="text" id="nosql-username" class="form-input" placeholder="USERNAME (JSON format)">
          <input type="text" id="nosql-password" class="form-input" placeholder="PASSWORD (JSON format)">
          
          <div class="attack-buttons">
            <button class="attack-btn" id="basicBypassBtn">Bypass to user1</button>
            <button class="attack-btn" id="discoverUsersBtn">Discover other users</button> <!-- Added back -->
            <button class="attack-btn" id="trueBtn">Always True</button>
            <button class="attack-btn" id="regexAttackBtn">Regex Attack</button>
            <button class="attack-btn" id="resetBtn">Reset</button>
          </div>
          
          <button class="execute-btn" id="executeBtn">EXECUTE QUERY</button>
        </div>
        
        <div class="response-area">
          <div class="response-title">SERVER RESPONSE</div>
          <div id="nosql-response">Awaiting query execution...</div>
        </div>
      </div>
    </div>
    <!-- (Previous terminal-footer remains the same) -->
  </div>

  <script>
    const users = [
      { username: "user1", password: "abc123", email: "user1@example.com", role: "user" },
      { username: "user2", password: "def456", email: "user2@example.com", role: "admin" },
      { username: "user3", password: "ghi789", email: "user3@example.com", role: "user" }
    ];

    // (Previous helper functions remain the same)

    function executeQuery() {
      const usernameInput = document.getElementById('nosql-username').value;
      const passwordInput = document.getElementById('nosql-password').value;
      
      let username, password;
      
      try {
        username = usernameInput ? JSON.parse(usernameInput) : "";
        password = passwordInput ? JSON.parse(passwordInput) : "";
      } catch (e) {
        document.getElementById('nosql-response').innerHTML = 
          `<span style="color: var(--warning-red)">Invalid JSON syntax</span>`;
        return;
      }
      
      addTerminalLine(`> Executing: db.users.find({ username: ${JSON.stringify(username)}, password: ${JSON.stringify(password)} })`);
      
      // Simulate MongoDB query
      let results = users.filter(user => {
        if (typeof username === 'object' && username.$ne) return user.username !== username.$ne;
        if (typeof password === 'object' && password.$ne) return user.password !== password.$ne;
        if (typeof username === 'object' && username.$nin) return !username.$nin.includes(user.username);
        if (typeof password === 'object' && password.$regex) return new RegExp(password.$regex).test(user.password);
        if (typeof username === 'string' && typeof password === 'string') {
          return user.username === username && user.password === password;
        }
        return false;
      });
      
      // Format response (show FIRST matched user only)
      let response;
      if (results.length === 0) {
        response = `<span style="color: var(--warning-red)">Login failed - No matching users</span>`;
      } else {
        const user = results[0]; // Show only the first matched user (not all)
        response = `
          <span style="color: var(--hacker-green)">Successfully logged in as ${user.username}</span><br><br>
          <span style="color: var(--cyber-blue)">User details:</span><br>
          Username: ${user.username}<br>
          Email: ${user.email}<br>
          Role: ${user.role}
        `;
      }
      
      document.getElementById('nosql-response').innerHTML = response;
      
      // Add breach effect if injection detected
      if (results.length > 0) {
        document.querySelector('.cyber-terminal').classList.add('breach-effect');
        setTimeout(() => {
          document.querySelector('.cyber-terminal').classList.remove('breach-effect');
        }, 1500);
      }
    }

    // Attack patterns
    document.getElementById('basicBypassBtn').addEventListener('click', () => {
      document.getElementById('nosql-username').value = JSON.stringify({$ne: "invalid"});
      document.getElementById('nosql-password').value = JSON.stringify({$ne: "invalid"});
      addTerminalLine('> Loaded bypass to user1: {"$ne":"invalid"}');
    });

    document.getElementById('discoverUsersBtn').addEventListener('click', () => {
      document.getElementById('nosql-username').value = JSON.stringify({$nin: ["user1"]});
      document.getElementById('nosql-password').value = JSON.stringify({$ne: "invalid"});
      addTerminalLine('> Loaded discover user2: {"$nin":["user1"]}');
    });

    // (Rest of the attack buttons remain the same)
  </script>
</body>
</html>
